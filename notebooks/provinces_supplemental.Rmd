---
title: "Provinces supplemental - DRAFT"
author: "Marcelo Eduardo Redoschi"
output: html_document
---

```{r echo=FALSE, message=FALSE}
source(file.path(getwd(),"helper_functions.R"))
library(ggplot2)
unexpanded_columns<-grep("totale_casi_",colnames(provinces_data), invert=TRUE)
provinces_data_unexpanded<-provinces_data[,unexpanded_columns]
total_cases_by_province<-select(provinces_data_unexpanded, dt, denominazione_provincia, denominazione_regione, totale_casi)

total_cases_by_province<-translated_column_names(total_cases_by_province)

# sorted by region name
total_cases_by_province<-arrange(total_cases_by_province, denominazione_regione, province_name, total_cases)

selected_province_name<-"Roma"

individual_province_data<-total_cases_by_province[total_cases_by_province$province_name==selected_province_name,]

num_days_recorded<-nrow(individual_province_data)


individual_province_data$total_cases_day_before<-head_na(individual_province_data$total_cases,1)
#individual_province_data$total_cases_two_days_before<-head_na(individual_province_data$total_cases,2)
individual_province_data$total_cases_three_days_before<-head_na(individual_province_data$total_cases,3)

individual_province_data$current_rate<-(individual_province_data$total_cases)/(individual_province_data$total_cases_day_before)
individual_province_data$current_perc_rate<-(individual_province_data$current_rate-1)*100
individual_province_data$growth_factor_in_three_days<-((individual_province_data$total_cases)/(individual_province_data$total_cases_three_days_before))
individual_province_data$cubic_rate<-'^'(individual_province_data$growth_factor_in_three_days,1/3)
individual_province_data$cubic_perc_rate<-(individual_province_data$cubic_rate-1)*100
```

```{r echo=FALSE, message=FALSE}
individual_province_rates<-individual_province_data[is.finite(individual_province_data$cubic_perc_rate),]
  
 txt<-'COVID-19 total case progression'
  province_chart<-provincial_cubic_rate_chart(individual_province_rates,selected_province_name)
 
#  province_chart_title<-paste(selected_province_name,"province")
#  province_chart<-ggplot(data=individual_province_rates)+geom_line(aes(x=dt,y=cubic_perc_rate),color="purple")+geom_line(aes(x=dt,y=current_perc_rate),color="darkblue")+ggtitle(province_chart_title)+xlab(paste(txt,format(min(individual_province_rates$dt),"%d %b"),"-",format(max(individual_province_rates$dt),"%d %b %Y")))+ylab("current vs. 3 day average (shown in purple) % growth rate")  
  print(province_chart)
```


*This page last updated: 19/4/2020*
